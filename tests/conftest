import pytest
import requests
import yaml
import os
from selenium import webdriver
from datetime import datetime
from utils.driver_factory import get_driver
from utils.logger import get_logger

logger = get_logger()



# Fixture de configuración

@pytest.fixture(scope="session")
def config():
    with open("config/config.yaml") as f:
        cfg = yaml.safe_load(f)
    logger.info("Configuración cargada correctamente")
    return cfg



# Fixture de WebDriver (UI)

@pytest.fixture
def driver(config):
    browser = config.get("browser", "chrome").lower()
    if browser == "chrome":
        options = webdriver.ChromeOptions()
        options.add_argument("--start-maximized")
        driver = webdriver.Chrome(options=options)
    elif browser == "firefox":
        driver = webdriver.Firefox()
        driver.maximize_window()
    else:
        raise ValueError(f"Browser {browser} no soportado")

    driver.implicitly_wait(config.get("implicit_wait", 5))
    logger.info(f"{browser.capitalize()} WebDriver iniciado")
    yield driver
    driver.quit()
    logger.info(f"{browser.capitalize()} WebDriver cerrado")



